---
- set_fact:
    filetypes:
    - {scheme: "text/x-org", file: "text-x-org.xml"}

##
# After clean install run M-x list-packages
##

- name: Install
  become: true
  apt: name=emacs
       state=latest

- name: Create dir
  file: path=/home/{{user}}/emacs
        state=directory

- name: Copy libs
  copy: src=lib
        dest=/home/{{user}}/emacs

- name: Copy .emacs config
  template: src=dot_emacs.j2
            dest=/home/{{user}}/.emacs
            backup=true

- name: Copy bashrc config
  copy: src=01-bashrc-emacs
        dest=/home/{{user}}/.bashrc.d/
        backup=true

- name: Copy filetypes
  copy: src={{item.file}}
        dest=/home/{{user}}/.local/share/mime/packages/
        backup=true
  with_items:
  - "{{filetypes}}"

- name: Add association schemes
  lineinfile:
    path: /home/{{user}}/.config/mimeapps.list
    backup: true
    regexp: "{{item.scheme}}=emacs.desktop"
    insertafter: "^[Added Associations]"
    line: "{{item.scheme}}=emacs.desktop;"
    state: present
  with_items:
  - "{{filetypes}}"

- name: Register file types
  shell: update-mime-database /home/{{user}}/.local/share/mime
