---
- hosts: localhost
  connection: local
  user: ten0s
  vars:
    cache_dir: /var/local/lib/ansible/cache
  tasks:
  - name: Update apt cache
    sudo: yes
    apt: update_cache=yes cache_valid_time=86400

  - name: Install build-essential
    sudo: yes
    apt: name=build-essential state=latest

  - name: Create download cache dir
    sudo: yes
    file: >
      path={{cache_dir}}
      state=directory
      mode=0777

  - name: Download Vagrant package
    get_url: >
      url=https://dl.bintray.com/mitchellh/vagrant/vagrant_1.7.1_x86_64.deb
      dest={{cache_dir}}/vagrant-1.7.1.deb

  - name: Install Vagrant
    sudo: yes
    apt: >
      deb={{cache_dir}}/vagrant-1.7.1.deb
      state=present

  - name: Install Vagrant's plugins
    # https://github.com/mitchellh/vagrant/wiki/Available-Vagrant-Plugins
    shell: (vagrant plugin list | grep {{item}}) || vagrant plugin install {{item}}
    with_items:
    - vagrant-vbox-snapshot
    - vagrant-vbguest

  - name: Download Virtualbox package
    get_url: >
       url=http://download.virtualbox.org/virtualbox/4.3.20/virtualbox-4.3_4.3.20-96996~Ubuntu~raring_amd64.deb
       dest={{cache_dir}}/virtualbox-4.3.20.deb

  - name: Install Virtualbox
    sudo: yes
    apt: >
      deb={{cache_dir}}/virtualbox-4.3.20.deb
      state=present
