---
- name: Create download cache dir
  sudo: true
  file: path={{cache_dir}}
        state=directory
        mode=0777

- name: Download Vagrant package
  get_url: url=https://dl.bintray.com/mitchellh/vagrant/vagrant_{{vagrant_ver}}_x86_64.deb
           dest={{cache_dir}}/vagrant-{{vagrant_ver}}.deb

- name: Install Vagrant
  sudo: true
  apt: deb={{cache_dir}}/vagrant-{{vagrant_ver}}.deb
       state=present

- name: Register `vagrant plugin list` output
  shell: vagrant plugin list
  register: plugins
  changed_when: false

- name: Install Vagrant's plugins
  # https://github.com/mitchellh/vagrant/wiki/Available-Vagrant-Plugins
  shell: vagrant plugin install {{item}}
  with_items:
  - vagrant-vbguest
  - vagrant-vbox-snapshot
  when: "'{{item}}' not in plugins.stdout"

#
# TODO: Setup apt source
# https://www.virtualbox.org/wiki/Linux_Downloads
#

- name: Install Virtualbox
  sudo: true
  apt: name=virtualbox-{{vbox_ver}} state=latest
